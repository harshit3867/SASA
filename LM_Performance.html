<!DOCTYPE html>
<html>
<head>
<title>Warehouse Performance Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Data labels plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
  background:
    radial-gradient(circle at 10% 10%, rgba(0, 200, 255, 0.10), transparent 40%),
    radial-gradient(circle at 90% 80%, rgba(255, 100, 200, 0.12), transparent 40%),
    linear-gradient(145deg, #020617 0%, #081022 45%, #020617 100%);
  color:#ffffff;
  font-family: Inter, Segoe UI, Arial;
  padding:24px;
  min-height:100vh;
}

.container{max-width:1320px;margin:auto}

.card{
  background:rgba(2,6,23,.8);
  border-radius:22px;
  padding:20px;
  border:1px solid rgba(255,255,255,.08);
  margin-top:14px;
}

select,button{
  background:rgba(2,6,23,.7);
  color:white;
  border:1px solid #374151;
  padding:10px 14px;
  border-radius:14px;
  margin-right:6px;
}

.kpis{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  margin-top:10px;
}

.kpi{
  background:#0b1324;
  border-radius:14px;
  padding:14px;
}

.green{color:#22c55e}
.yellow{color:#eab308}
.red{color:#ef4444}

table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #374151;padding:8px;text-align:center}
th{background:#020617}
</style>
</head>

<body>

<div id="dashboard" class="container">

<h2>ğŸ“¦ Flipkart â€“ Warehouse Performance Dashboard</h2>
<p>Zippee Last-mile | December Performance</p>

<div class="card">

<b>Select Warehouse & Date Range</b><br><br>

<select id="citySelect">
<option>Moradabad</option>
<option>Prayagraj</option>
<option>Siliguri</option>
<option>Surat</option>
</select>

<select id="startDate"></select>
<select id="endDate"></select>

<button onclick="downloadPNG()">ğŸ–¼ Download PNG</button>
<button onclick="downloadPDF()">ğŸ“„ Download PDF</button>

<div class="kpis">

<div class="kpi">
<div>Total Orders</div>
<div id="kpiTotal" style="font-size:22px;font-weight:800"></div>
</div>

<div class="kpi">
<div>Delivered Orders</div>
<div id="kpiDelivered" style="font-size:22px;font-weight:800"></div>
</div>

<div class="kpi">
<div>Average Delivery %</div>
<div id="kpiPct" style="font-size:22px;font-weight:800"></div>
<div id="kpiRemark"></div>
</div>

</div>
</div>

<div class="card"><h3>Total vs Delivered</h3><canvas id="ordersCanvas"></canvas></div>
<div class="card"><h3>Delivery % Trend</h3><canvas id="percentageCanvas"></canvas></div>
<div class="card"><h3>CD vs NCD Breaches</h3><canvas id="breachCanvas"></canvas></div>
<div class="card"><h3>PRTO vs RTO</h3><canvas id="rtoCanvas"></canvas></div>
<div class="card"><h3>Re-Attempt Trend (RA)</h3><canvas id="raCanvas"></canvas></div>

<div class="card">
<h3>ğŸ“† Weekly Summary</h3>
<table id="weeklyTable"></table>
</div>

<div class="card">
<h3>ğŸ­ Warehouse Comparison â€“ All Graphs</h3>

<select id="compareA">
<option>Moradabad</option>
<option>Prayagraj</option>
<option>Siliguri</option>
<option>Surat</option>
</select>

<select id="compareB">
<option>Moradabad</option>
<option>Prayagraj</option>
<option>Siliguri</option>
<option>Surat</option>
</select>

<br><br>

<b>ğŸ“¦ Total vs Delivered</b>
<canvas id="cmpOrdersCanvas"></canvas>

<b>ğŸ“ˆ Delivery %</b>
<canvas id="cmpPctCanvas"></canvas>

<b>âš ï¸ CD vs NCD</b>
<canvas id="cmpBreachCanvas"></canvas>

<b>ğŸšš RTO vs PRTO</b>
<canvas id="cmpRTOCanvas"></canvas>

<b>ğŸ” Re-Attempt (RA)</b>
<canvas id="cmpRACanvas"></canvas>

</div>

</div>

<script>
/* REGISTER DATALABELS */
Chart.register(ChartDataLabels);

/* GLOBAL LEGENDS + DATA LABEL STYLE */
Chart.defaults.plugins.legend.display = true;
Chart.defaults.plugins.legend.labels.color = "#ffffff";

Chart.defaults.plugins.datalabels.color = "#ffffff";
Chart.defaults.plugins.datalabels.anchor = "end";
Chart.defaults.plugins.datalabels.align = "top";
Chart.defaults.plugins.datalabels.font = {weight:"bold"};

/* ---------- WATERMARK ---------- */
const watermarkPlugin={
 id:'wm',
 beforeDraw(chart){
  const {ctx,chartArea}=chart;if(!chartArea)return;
  ctx.save();ctx.globalAlpha=.06;
  ctx.translate((chartArea.left+chartArea.right)/2,(chartArea.top+chartArea.bottom)/2);
  ctx.rotate(-Math.PI/6);
  ctx.textAlign='center';
  ctx.font='bold 34px Arial';
  ctx.fillStyle='#ffffff';
  ctx.fillText('HARSHIT SAINI  DATA ANALYST',0,0);
  ctx.restore();
 }
};

/* ---------- FULL DATASET (UNCHANGED) ---------- */
const dataSet={
Moradabad:{dates:["01 Dec","02 Dec","03 Dec","04 Dec","05 Dec","06 Dec","07 Dec","08 Dec","09 Dec","10 Dec","11 Dec","12 Dec","13 Dec","14 Dec","15 Dec","16 Dec","17 Dec","18 Dec","19 Dec","20 Dec","21 Dec","22 Dec","23 Dec","24 Dec","25 Dec","26 Dec","27 Dec","28 Dec","29 Dec","30 Dec","31 Dec"],
total:[453,460,430,460,468,487,535,454,412,453,448,344,394,485,443,342,350,303,293,390,428,401,336,312,335,348,344,431,0,0,0],
delivered:[442,436,410,435,441,465,515,441,389,439,414,328,371,465,435,329,333,299,283,377,412,386,325,302,320,345,336,420,0,0,0],
pct:[97.57,94.78,95.35,94.57,94.23,95.48,96.26,97.14,94.42,96.91,92.41,95.35,94.16,95.88,98.19,96.20,95.14,98.68,96.59,96.67,96.26,96.26,96.73,96.79,95.52,99.14,97.67,97.45,0,0,0],
cd:[11,23,18,21,17,12,8,3,8,7,15,6,0,17,1,8,2,0,9,13,15,14,10,10,15,3,6,11,0,0,0],
ncd:[0,1,1,4,0,0,0,1,0,1,0,0,2,1,0,0,1,0,1,0,1,0,1,0,0,0,2,0,0,0,0],
prto:[2,1,3,2,2,1,2,0,1,3,0,4,0,1,1,1,0,3,0,0,1,2,1,2,1,0,1,1,0,0,0],
rto:[5,7,7,6,6,8,7,3,6,5,15,5,0,6,0,6,2,0,3,8,5,5,1,3,6,1,3,1,0,0,0],
ra:[6,17,12,19,3,4,0,1,2,3,0,1,0,11,1,2,1,0,7,5,11,9,10,7,9,2,3,0,0,0,0]},

Prayagraj:{dates:["01 Dec","02 Dec","03 Dec","04 Dec","05 Dec","06 Dec","07 Dec","08 Dec","09 Dec","10 Dec","11 Dec","12 Dec","13 Dec","14 Dec","15 Dec","16 Dec","17 Dec","18 Dec","19 Dec","20 Dec","21 Dec","22 Dec","23 Dec","25 Dec","26 Dec","27 Dec","28 Dec","29 Dec","30 Dec","31 Dec"],
total:[850,1026,804,883,811,685,958,854,751,648,867,796,721,816,655,673,829,816,897,892,858,844,759,759,838,715,861,934,0,0,0],
delivered:[546,781,632,670,619,571,810,679,624,599,794,706,669,738,578,613,722,743,811,806,803,804,712,718,785,681,799,888,0,0,0],
pct:[64.24,76.12,78.61,75.88,76.33,83.36,84.55,79.51,83.09,92.44,91.58,88.69,92.79,90.44,88.24,91.08,87.09,91.05,90.41,90.36,93.59,95.26,93.81,94.60,93.68,95.24,92.80,95.07,0,0,0],
cd:[49,72,50,49,25,30,39,34,39,33,37,46,22,24,14,21,25,14,49,62,45,38,43,40,49,33,56,43,0,0,0],
ncd:[109,111,87,108,26,5,14,31,2,6,13,7,8,16,5,12,19,12,25,15,10,2,4,1,4,1,6,3,0,0,0],
prto:[8,12,4,13,13,3,4,14,2,8,9,2,22,13,13,6,9,13,7,4,8,11,6,10,8,9,10,8,0,0,0],
rto:[9,15,10,10,10,8,5,14,10,16,18,6,18,2,7,12,12,5,19,18,13,13,25,16,9,11,20,15,0,0,0],
ra:[147,163,112,128,36,14,26,35,10,22,32,25,12,34,12,21,29,21,54,58,42,27,22,25,44,23,42,31,0,0,0]},

Siliguri:{dates:["01 Dec","02 Dec","03 Dec","04 Dec","05 Dec","06 Dec","07 Dec","08 Dec","09 Dec","10 Dec","11 Dec","12 Dec","13 Dec","14 Dec","15 Dec","16 Dec","17 Dec","18 Dec","19 Dec","20 Dec","21 Dec","22 Dec","23 Dec","24 Dec","25 Dec","26 Dec","27 Dec","28 Dec","29 Dec","30 Dec","31 Dec"],
total:[734,696,689,665,674,638,577,438,486,486,565,435,431,444,415,566,522,544,550,507,440,356,542,450,551,409,490,588,0,0,0],
delivered:[531,523,542,527,597,606,520,412,466,458,523,409,391,411,406,535,496,514,517,481,406,345,521,430,531,385,466,545,0,0,0],
pct:[72.34,75.14,78.66,79.25,88.58,94.98,90.12,94.06,95.88,94.24,92.57,94.02,90.72,92.57,97.83,94.52,95.02,94.49,94.00,94.87,92.27,96.91,96.13,95.56,96.37,94.13,95.10,92.69,0,0,0],
cd:[69,44,41,39,23,22,22,18,11,26,33,25,6,26,5,30,26,25,33,24,34,8,19,20,20,23,22,42,0,0,0],
ncd:[12,37,8,4,0,0,2,1,0,2,0,0,1,1,0,0,0,0,0,2,0,0,2,0,0,1,1,1,0,0,0],
prto:[6,7,6,6,6,13,9,6,2,6,8,3,1,3,1,4,5,0,10,3,1,7,0,3,3,2,6,3,0,0,0],
rto:[6,7,6,6,6,13,9,6,2,6,8,3,1,3,1,4,5,0,10,3,1,7,0,3,3,2,6,9,0,0,0],
ra:[62,27,24,30,7,10,10,11,1,20,18,11,1,25,4,20,19,12,16,16,25,7,13,13,15,11,15,34,0,0,0]},

Surat:{dates:["01 Dec","02 Dec","03 Dec","04 Dec","05 Dec","06 Dec","07 Dec","08 Dec","09 Dec","10 Dec","11 Dec","12 Dec","13 Dec","14 Dec","15 Dec","16 Dec","17 Dec","18 Dec","19 Dec","20 Dec","21 Dec","22 Dec","23 Dec","24 Dec","25 Dec","26 Dec","27 Dec","28 Dec","29 Dec","30 Dec","31 Dec"],
total:[468,471,490,523,490,472,498,456,460,490,553,492,531,535,488,502,539,484,459,463,433,471,426,512,491,457,537,467,0,0,0],
delivered:[417,415,425,442,434,421,466,410,410,457,512,461,510,479,449,473,513,450,421,431,406,422,399,486,463,432,511,421,0,0,0],
pct:[89.10,88.11,86.73,84.51,88.57,89.19,93.57,89.91,89.13,93.27,92.59,93.70,96.05,89.53,92.01,94.22,95.18,92.98,91.72,93.09,93.76,89.60,93.66,94.92,94.30,94.53,95.16,90.15,0,0,0],
cd:[18,22,33,48,25,21,18,18,32,13,13,12,8,12,17,8,13,13,35,27,24,47,25,25,15,14,20,38,0,0,0],
ncd:[7,13,12,7,2,1,0,0,1,0,0,1,1,1,0,1,0,1,3,5,3,2,2,1,0,2,0,8,0,0,0],
prto:[7,8,8,13,13,7,9,4,9,8,13,6,12,7,11,6,5,8,5,8,4,7,2,7,4,7,1,6,0,0,0],
rto:[6,7,12,12,12,9,10,4,20,13,12,7,7,8,11,8,10,8,8,11,6,12,12,9,7,8,2,12,0,0,0],
ra:[19,28,33,43,8,12,3,10,6,0,1,2,2,5,1,1,2,4,26,20,18,34,15,17,8,8,18,31,0,0,0]}
};

/* ---------- HELPERS ---------- */
function sum(a){return a.reduce((x,y)=>x+y,0);}
function avg(a){return (sum(a)/a.length).toFixed(2);}
function chunk7(a){let r=[];for(let i=0;i<a.length;i+=7)r.push(a.slice(i,i+7));return r;}

let ordersChart,percentageChart,breachChart,rtoChart,raChart;
let cmpOrdersChart,cmpPctChart,cmpBreachChart,cmpRTOChart,cmpRAChart;

/* ---------- RENDER MAIN ---------- */
function render(){
const city=citySelect.value;
const d=dataSet[city];

let start=startDate.value||d.dates[0];
let end=endDate.value||d.dates[d.dates.length-1];
let s=d.dates.indexOf(start),e=d.dates.indexOf(end);
if(s>e){let t=s;s=e;e=t;}

const r={
dates:d.dates.slice(s,e+1),
total:d.total.slice(s,e+1),
delivered:d.delivered.slice(s,e+1),
pct:d.pct.slice(s,e+1),
cd:d.cd.slice(s,e+1),
ncd:d.ncd.slice(s,e+1),
prto:d.prto.slice(s,e+1),
rto:d.rto.slice(s,e+1),
ra:d.ra.slice(s,e+1)
};

kpiTotal.innerText=sum(r.total);
kpiDelivered.innerText=sum(r.delivered);
const p=avg(r.pct);
kpiPct.innerText=p+"%";
if(p>=90)kpiRemark.innerHTML="ğŸŸ¢ <span class='green'>Good</span>";
else if(p>=85)kpiRemark.innerHTML="ğŸŸ¡ <span class='yellow'>Average</span>";
else kpiRemark.innerHTML="ğŸ”´ <span class='red'>Poor</span>";

[ordersChart,percentageChart,breachChart,rtoChart,raChart].forEach(c=>c&&c.destroy());

ordersChart=new Chart(ordersCanvas,{type:"line",
data:{labels:r.dates,datasets:[
{label:"Total Orders",data:r.total,borderWidth:3,tension:.35},
{label:"Delivered Orders",data:r.delivered,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}},plugins:[watermarkPlugin]});

percentageChart=new Chart(percentageCanvas,{type:"line",
data:{labels:r.dates,datasets:[
{label:"Delivery %",data:r.pct,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}},plugins:[watermarkPlugin]});

breachChart=new Chart(breachCanvas,{type:"line",
data:{labels:r.dates,datasets:[
{label:"CD Breaches",data:r.cd,borderWidth:3,tension:.35},
{label:"NCD Breaches",data:r.ncd,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}},plugins:[watermarkPlugin]});

rtoChart=new Chart(rtoCanvas,{type:"line",
data:{labels:r.dates,datasets:[
{label:"PRTO",data:r.prto,borderWidth:3,tension:.35},
{label:"RTO",data:r.rto,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}},plugins:[watermarkPlugin]});

raChart=new Chart(raCanvas,{type:"line",
data:{labels:r.dates,datasets:[
{label:"Re-Attempt (RA)",data:r.ra,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}},plugins:[watermarkPlugin]});

let weeks=chunk7(r.dates).map((w,i)=>({
week:"Week "+(i+1),
orders:sum(r.total.slice(i*7,i*7+7)),
del:sum(r.delivered.slice(i*7,i*7+7)),
pct:avg(r.pct.slice(i*7,i*7+7))
}));

let t="<tr><th>Week</th><th>Total</th><th>Delivered</th><th>Delivery %</th></tr>";
weeks.forEach(w=>t+=`<tr><td>${w.week}</td><td>${w.orders}</td><td>${w.del}</td><td>${w.pct}%</td></tr>`);
weeklyTable.innerHTML=t;

renderCompare();
}

/* ---------- RENDER COMPARISON ---------- */
function renderCompare(){

[cmpOrdersChart,cmpPctChart,cmpBreachChart,cmpRTOChart,cmpRAChart].forEach(c=>c&&c.destroy());

const A=dataSet[compareA.value];
const B=dataSet[compareB.value];

cmpOrdersChart=new Chart(cmpOrdersCanvas,{
type:"line",
data:{labels:A.dates,datasets:[
{label:`${compareA.value} Total`,data:A.total,borderWidth:3,tension:.35},
{label:`${compareB.value} Total`,data:B.total,borderWidth:3,tension:.35},
{label:`${compareA.value} Delivered`,data:A.delivered,borderWidth:3,tension:.35},
{label:`${compareB.value} Delivered`,data:B.delivered,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}}
});

cmpPctChart=new Chart(cmpPctCanvas,{
type:"line",
data:{labels:A.dates,datasets:[
{label:`${compareA.value} %`,data:A.pct,borderWidth:3,tension:.35},
{label:`${compareB.value} %`,data:B.pct,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}}
});

cmpBreachChart=new Chart(cmpBreachCanvas,{
type:"line",
data:{labels:A.dates,datasets:[
{label:`${compareA.value} CD`,data:A.cd,borderWidth:3,tension:.35},
{label:`${compareB.value} CD`,data:B.cd,borderWidth:3,tension:.35},
{label:`${compareA.value} NCD`,data:A.ncd,borderWidth:3,tension:.35},
{label:`${compareB.value} NCD`,data:B.ncd,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}}
});

cmpRTOChart=new Chart(cmpRTOCanvas,{
type:"line",
data:{labels:A.dates,datasets:[
{label:`${compareA.value} PRTO`,data:A.prto,borderWidth:3,tension:.35},
{label:`${compareB.value} PRTO`,data:B.prto,borderWidth:3,tension:.35},
{label:`${compareA.value} RTO`,data:A.rto,borderWidth:3,tension:.35},
{label:`${compareB.value} RTO`,data:B.rto,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}}
});

cmpRAChart=new Chart(cmpRACanvas,{
type:"line",
data:{labels:A.dates,datasets:[
{label:`${compareA.value} RA`,data:A.ra,borderWidth:3,tension:.35},
{label:`${compareB.value} RA`,data:B.ra,borderWidth:3,tension:.35}
]},
options:{plugins:{legend:{display:true},datalabels:{display:true}}}
});
}

/* ---------- DOWNLOAD ---------- */
function downloadPNG(){
 html2canvas(dashboard).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL();
  a.download="dashboard.png";
  a.click();
 });
}

function downloadPDF(){
 html2canvas(dashboard).then(c=>{
  const img=c.toDataURL("image/png");
  const pdf=new jspdf.jsPDF("p","mm","a4");
  const w=210,h=w*c.height/c.width;
  pdf.addImage(img,"PNG",0,0,w,h);
  pdf.save("dashboard.pdf");
 });
}

/* ---------- INIT ---------- */
function loadDates(){
 const d=dataSet[citySelect.value].dates;
 startDate.innerHTML=endDate.innerHTML="";
 d.forEach(v=>{
  startDate.innerHTML+=`<option>${v}</option>`;
  endDate.innerHTML+=`<option>${v}</option>`;
 });
 endDate.value=d[d.length-1];
}

citySelect.onchange=()=>{loadDates();render();}
startDate.onchange=endDate.onchange=render;
compareA.onchange=compareB.onchange=renderCompare;

loadDates();
render();
</script>

</body>
</html>
